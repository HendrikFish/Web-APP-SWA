const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/confirmation-modal-nNV1CCn0.js","assets/bootstrap.esm-DGoQCxh1.js","assets/bootstrap-DhAbcaWn.css","assets/toast-notification-BBb3bACE.js","assets/toast-notification-CC4azLeq.css"])))=>i.map(i=>d[i]);
import"./bootstrap.esm-DGoQCxh1.js";import{i as ge}from"./header-DaFr1czl.js";/* empty css               */import{showToast as z}from"./toast-notification-BBb3bACE.js";import{c as R,g as ve}from"./_commonjsHelpers-Cpj98o6Y.js";var K;(function(t){var a=function(){function n(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(n.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(e){this._dropEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(e){this._effectAllowed=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),n.prototype.clearData=function(e){e!=null?delete this._data[e]:this._data=null},n.prototype.getData=function(e){return this._data[e]||""},n.prototype.setData=function(e,s){this._data[e]=s},n.prototype.setDragImage=function(e,s,o){var i=r._instance;i._imgCustom=e,i._imgOffset={x:s,y:o}},n}();t.DataTransfer=a;var r=function(){function n(){if(this._lastClick=0,n._instance)throw"DragDropTouch instance already created.";var e=!1;if(document.addEventListener("test",function(){},{get passive(){return e=!0,!0}}),"ontouchstart"in document){var s=document,o=this._touchstart.bind(this),i=this._touchmove.bind(this),d=this._touchend.bind(this),c=e?{passive:!1,capture:!1}:!1;s.addEventListener("touchstart",o,c),s.addEventListener("touchmove",i,c),s.addEventListener("touchend",d),s.addEventListener("touchcancel",d)}}return n.getInstance=function(){return n._instance},n.prototype._touchstart=function(e){var s=this;if(this._shouldHandle(e)){if(Date.now()-this._lastClick<n._DBLCLICK&&this._dispatchEvent(e,"dblclick",e.target)){e.cancelable&&e.preventDefault(),this._reset();return}this._reset();var o=this._closestDraggable(e.target);o&&!this._dispatchEvent(e,"mousemove",e.target)&&!this._dispatchEvent(e,"mousedown",e.target)&&(this._dragSource=o,this._ptDown=this._getPoint(e),this._lastTouch=e,e.cancelable&&e.preventDefault(),setTimeout(function(){s._dragSource==o&&s._img==null&&s._dispatchEvent(e,"contextmenu",o)&&s._reset()},n._CTXMENU),n._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){s._isDragEnabled=!0,s._touchmove(e)},n._PRESSHOLDAWAIT)))}},n.prototype._touchmove=function(e){if(this._shouldCancelPressHoldMove(e)){this._reset();return}if(this._shouldHandleMove(e)||this._shouldHandlePressHoldMove(e)){var s=this._getTarget(e);if(this._dispatchEvent(e,"mousemove",s)){this._lastTouch=e,e.cancelable&&e.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(e)&&(this._dispatchEvent(e,"dragstart",this._dragSource),this._createImage(e),this._dispatchEvent(e,"dragenter",s)),this._img&&(this._lastTouch=e,e.cancelable&&e.preventDefault(),s!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(e,"dragenter",s),this._lastTarget=s),this._moveImage(e),this._isDropZone=this._dispatchEvent(e,"dragover",s))}},n.prototype._touchend=function(e){if(this._shouldHandle(e)){if(this._dispatchEvent(this._lastTouch,"mouseup",e.target)){e.cancelable&&e.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",e.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(e.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},n.prototype._shouldHandle=function(e){return e&&!e.defaultPrevented&&e.touches&&e.touches.length<2},n.prototype._shouldHandleMove=function(e){return!n._ISPRESSHOLDMODE&&this._shouldHandle(e)},n.prototype._shouldHandlePressHoldMove=function(e){return n._ISPRESSHOLDMODE&&this._isDragEnabled&&e&&e.touches&&e.touches.length},n.prototype._shouldCancelPressHoldMove=function(e){return n._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(e)>n._PRESSHOLDMARGIN},n.prototype._shouldStartDragging=function(e){var s=this._getDelta(e);return s>n._THRESHOLD||n._ISPRESSHOLDMODE&&s>=n._PRESSHOLDTHRESHOLD},n.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new a,clearInterval(this._pressHoldInterval)},n.prototype._getPoint=function(e,s){return e&&e.touches&&(e=e.touches[0]),{x:s?e.pageX:e.clientX,y:s?e.pageY:e.clientY}},n.prototype._getDelta=function(e){if(n._ISPRESSHOLDMODE&&!this._ptDown)return 0;var s=this._getPoint(e);return Math.abs(s.x-this._ptDown.x)+Math.abs(s.y-this._ptDown.y)},n.prototype._getTarget=function(e){for(var s=this._getPoint(e),o=document.elementFromPoint(s.x,s.y);o&&getComputedStyle(o).pointerEvents=="none";)o=o.parentElement;return o},n.prototype._createImage=function(e){this._img&&this._destroyImage();var s=this._imgCustom||this._dragSource;if(this._img=s.cloneNode(!0),this._copyStyle(s,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var o=s.getBoundingClientRect(),i=this._getPoint(e);this._imgOffset={x:i.x-o.left,y:i.y-o.top},this._img.style.opacity=n._OPACITY.toString()}this._moveImage(e),document.body.appendChild(this._img)},n.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},n.prototype._moveImage=function(e){var s=this;requestAnimationFrame(function(){if(s._img){var o=s._getPoint(e,!0),i=s._img.style;i.position="absolute",i.pointerEvents="none",i.zIndex="999999",i.left=Math.round(o.x-s._imgOffset.x)+"px",i.top=Math.round(o.y-s._imgOffset.y)+"px"}})},n.prototype._copyProps=function(e,s,o){for(var i=0;i<o.length;i++){var d=o[i];e[d]=s[d]}},n.prototype._copyStyle=function(e,s){if(n._rmvAtts.forEach(function(l){s.removeAttribute(l)}),e instanceof HTMLCanvasElement){var o=e,i=s;i.width=o.width,i.height=o.height,i.getContext("2d").drawImage(o,0,0)}for(var d=getComputedStyle(e),c=0;c<d.length;c++){var h=d[c];h.indexOf("transition")<0&&(s.style[h]=d[h])}s.style.pointerEvents="none";for(var c=0;c<e.children.length;c++)this._copyStyle(e.children[c],s.children[c])},n.prototype._dispatchEvent=function(e,s,o){if(e&&o){var i=document.createEvent("Event"),d=e.touches?e.touches[0]:e;return i.initEvent(s,!0,!0),i.button=0,i.which=i.buttons=1,this._copyProps(i,e,n._kbdProps),this._copyProps(i,d,n._ptProps),i.dataTransfer=this._dataTransfer,o.dispatchEvent(i),i.defaultPrevented}return!1},n.prototype._closestDraggable=function(e){for(;e;e=e.parentElement)if(e.hasAttribute("draggable")&&e.draggable)return e;return null},n}();r._instance=new r,r._THRESHOLD=5,r._OPACITY=.5,r._DBLCLICK=500,r._CTXMENU=900,r._ISPRESSHOLDMODE=!1,r._PRESSHOLDAWAIT=400,r._PRESSHOLDMARGIN=25,r._PRESSHOLDTHRESHOLD=0,r._rmvAtts="id,class,style,draggable".split(","),r._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),r._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),t.DragDropTouch=r})(K||(K={}));const N={api:{getPlan:(t,a)=>`/api/menueplan/${t}/${a}`,savePlan:(t,a)=>`/api/menueplan/${t}/${a}`,updateSnapshot:(t,a)=>`/api/menueplan/${t}/${a}/snapshot`},data:{stammdaten:"/shared/data/menueplaene/stammdaten.json"}};async function M(t,a={}){const r=localStorage.getItem("token"),n={"Content-Type":"application/json",...a.headers};r&&(n.Authorization=`Bearer ${r}`);try{const e=await fetch(t,{...a,headers:n});if(!e.ok)throw new Error(`Netzwerk-Antwort war nicht ok: ${e.statusText}`);return e.status===204?null:await e.json()}catch(e){throw console.error(`Fehler beim Abrufen der Daten von ${t}:`,e),e}}const T={getStammdaten:()=>M(N.data.stammdaten),getEinrichtungen:()=>M("/shared/data/einrichtungen/einrichtungen.json"),getRezepte:()=>M("/shared/data/rezepte/rezepte.json"),getModalMessages:()=>M("/shared/config/modal-messages.json"),getMenueplan:(t,a)=>{const r=N.api.getPlan(t,a);return M(r)},saveMenueplan:(t,a,r)=>{const n=N.api.savePlan(t,a);return M(n,{method:"POST",body:JSON.stringify(r)})},updateEinrichtungsSnapshot:(t,a)=>{const r=N.api.updateSnapshot(t,a);return M(r,{method:"PUT"})}};var ye="Expected a function",Y=NaN,Ee="[object Symbol]",_e=/^\s+|\s+$/g,be=/^[-+]0x[0-9a-f]+$/i,Se=/^0b[01]+$/i,ze=/^0o[0-7]+$/i,De=parseInt,we=typeof R=="object"&&R&&R.Object===Object&&R,Le=typeof self=="object"&&self&&self.Object===Object&&self,Te=we||Le||Function("return this")(),Ce=Object.prototype,Me=Ce.toString,Pe=Math.max,Ie=Math.min,W=function(){return Te.Date.now()};function ke(t,a,r){var n,e,s,o,i,d,c=0,h=!1,l=!1,u=!0;if(typeof t!="function")throw new TypeError(ye);a=X(a)||0,U(r)&&(h=!!r.leading,l="maxWait"in r,s=l?Pe(X(r.maxWait)||0,a):s,u="trailing"in r?!!r.trailing:u);function m(v){var S=n,L=e;return n=e=void 0,c=v,o=t.apply(L,S),o}function p(v){return c=v,i=setTimeout(_,a),h?m(v):o}function f(v){var S=v-d,L=v-c,H=a-S;return l?Ie(H,s-L):H}function E(v){var S=v-d,L=v-c;return d===void 0||S>=a||S<0||l&&L>=s}function _(){var v=W();if(E(v))return b(v);i=setTimeout(_,f(v))}function b(v){return i=void 0,u&&n?m(v):(n=e=void 0,o)}function x(){i!==void 0&&clearTimeout(i),c=0,n=d=e=i=void 0}function $(){return i===void 0?o:b(W())}function k(){var v=W(),S=E(v);if(n=arguments,e=this,d=v,S){if(i===void 0)return p(d);if(l)return i=setTimeout(_,a),m(d)}return i===void 0&&(i=setTimeout(_,a)),o}return k.cancel=x,k.flush=$,k}function U(t){var a=typeof t;return!!t&&(a=="object"||a=="function")}function Oe(t){return!!t&&typeof t=="object"}function Ae(t){return typeof t=="symbol"||Oe(t)&&Me.call(t)==Ee}function X(t){if(typeof t=="number")return t;if(Ae(t))return Y;if(U(t)){var a=typeof t.valueOf=="function"?t.valueOf():t;t=U(a)?a+"":a}if(typeof t!="string")return t===0?t:+t;t=t.replace(_e,"");var r=Se.test(t);return r||ze.test(t)?De(t.slice(2),r?2:8):be.test(t)?Y:+t}var xe=ke;const $e=ve(xe),g={currentDate:new Date,currentPlan:null,stammdaten:{rezepte:[],einrichtungen:[],stammdaten:{kategorien:[]}},modalMessages:{},currentDragData:null,onStateChange:()=>{}},He=$e(async(t,a)=>{a.onSaving();try{const{year:r,week:n}=t;let e;t.einrichtungsSnapshot?(console.log("📸 Verwende bestehenden Einrichtungs-Snapshot beim Speichern"),e={...t}):(console.log("📸 Erstelle neuen Einrichtungs-Snapshot für neuen Plan"),e={...t,einrichtungsSnapshot:We()}),await T.saveMenueplan(r,n,e),a.onSuccess()}catch(r){console.error("Fehler beim automatischen Speichern:",r),a.onError()}},1500);function Re(t){g.currentPlan&&He(g.currentPlan,t)}function C(t){t=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));const a=new Date(Date.UTC(t.getUTCFullYear(),0,1)),r=Math.ceil(((t-a)/864e5+1)/7);return[t.getUTCFullYear(),r]}const D=()=>g,A=()=>g.currentDate;function oe(t){Object.assign(g,t),(t.currentPlan||t.stammdaten)&&g.onStateChange()}function Ne(t){g.onStateChange=t}function ce(t){g.currentDate=t}function P(t){g.currentDragData=t}function je(t,a){const r=["montag","dienstag","mittwoch","donnerstag","freitag","samstag","sonntag"],n={year:t,week:a,days:{}};return r.forEach(e=>{n.days[e]={Mahlzeiten:{},Zuweisungen:{menu1:[],menu2:[]}},g.stammdaten.stammdaten.kategorien.forEach(s=>{n.days[e].Mahlzeiten[s.id]=[]})}),n}function Be(t,a,r){const n=je(a,r);if(!t||!t.days)return n;n.year=t.year||a,n.week=t.week||r,t.einrichtungsSnapshot&&(n.einrichtungsSnapshot=t.einrichtungsSnapshot,console.log("📸 Bestehender Einrichtungs-Snapshot beim Laden übernommen"));for(const e in n.days)if(t.days[e]){if(t.days[e].Mahlzeiten)for(const s in n.days[e].Mahlzeiten)t.days[e].Mahlzeiten[s]&&(n.days[e].Mahlzeiten[s]=t.days[e].Mahlzeiten[s]);t.days[e].Zuweisungen&&(n.days[e].Zuweisungen=t.days[e].Zuweisungen)}return n}function j(t){const[a,r]=C(g.currentDate);g.currentPlan=Be(t,a,r),g.onStateChange()}function We(){const{einrichtungen:t,stammdaten:a}=g.stammdaten,r={einrichtungen:[],generatedAt:new Date().toISOString(),categories:a.kategorien.map(n=>({id:n.id,name:n.name}))};return t.forEach(n=>{const e={id:n.id,name:n.name,kuerzel:n.kuerzel,isIntern:n.isIntern||!1,speiseplan:n.speiseplan||{},snapshotMetadata:{originalDataTimestamp:n.updatedAt||n.createdAt||null}};r.einrichtungen.push(e)}),r}function le(t,a,r,n,e,s){var i,d,c,h;g.currentPlan||(g.currentPlan={}),g.currentPlan.days||(g.currentPlan.days={});const{days:o}=g.currentPlan;if(e&&s&&e!=="null"&&s!=="null"){const l=(d=(i=o[e])==null?void 0:i.Mahlzeiten)==null?void 0:d[s],u=(h=(c=o[t])==null?void 0:c.Mahlzeiten)==null?void 0:h[a];if(!l||!u)return;const m=l.findIndex(p=>p.id===r);if(m>-1){const[p]=l.splice(m,1);u.some(f=>f.id===r)||u.push(p)}}else{o[t]||(o[t]={Mahlzeiten:{},Zuweisungen:{}}),o[t].Mahlzeiten[a]||(o[t].Mahlzeiten[a]=[]);const l=o[t].Mahlzeiten[a];l.some(u=>u.id===r)||l.push({id:r,name:n})}g.onStateChange()}function de(t,a,r,n){var d,c,h,l,u;if(!((d=g.currentPlan)!=null&&d.days)||t===r&&a===n)return;const{days:e}=g.currentPlan,s=(h=(c=e[r])==null?void 0:c.Mahlzeiten)==null?void 0:h[n],o=(u=(l=e[t])==null?void 0:l.Mahlzeiten)==null?void 0:u[a];if(!s||!o)return;const i=[...o];e[t].Mahlzeiten[a]=[...s],e[r].Mahlzeiten[n]=i,g.onStateChange()}function qe(t,a,r){const n=g.currentPlan.days[t].Mahlzeiten[a],e=n.findIndex(s=>s.id===r);e>-1&&(n.splice(e,1),g.onStateChange())}function Ze(){var r;if(!((r=g.currentPlan)!=null&&r.days))return;const{days:t}=g.currentPlan;["montag","dienstag","mittwoch","donnerstag","freitag","samstag","sonntag"].forEach(n=>{t[n]&&(t[n].Mahlzeiten&&Object.keys(t[n].Mahlzeiten).forEach(e=>{t[n].Mahlzeiten[e]=[]}),t[n].Zuweisungen&&(t[n].Zuweisungen={}))}),g.onStateChange()}function Fe(t,a,r){var o,i,d;if(!((d=(i=(o=g.currentPlan)==null?void 0:o.days)==null?void 0:i[t])!=null&&d.Zuweisungen)){console.error("Zuweisungen nicht initialisiert für",t);return}const n=g.currentPlan.days[t].Zuweisungen,e=a==="menu1"?"menu2":"menu1";n[a]||(n[a]=[]),n[e]||(n[e]=[]);const s=n[a].indexOf(r);if(s>-1)n[a].splice(s,1);else{n[a].push(r);const c=n[e].indexOf(r);c>-1&&n[e].splice(c,1)}g.onStateChange()}const Ue="modulepreload",Ve=function(t){return"/"+t},J={},I=function(a,r,n){let e=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));e=Promise.allSettled(r.map(d=>{if(d=Ve(d),d in J)return;J[d]=!0;const c=d.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${h}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":Ue,c||(l.as="script"),l.crossOrigin="",l.href=d,i&&l.setAttribute("nonce",i),document.head.appendChild(l),c)return new Promise((u,m)=>{l.addEventListener("load",u),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return e.then(o=>{for(const i of o||[])i.status==="rejected"&&s(i.reason);return a().catch(s)})};let V=()=>{};function Q(t){const a=document.getElementById("menueplan-suche-ergebnisse");if(a.innerHTML="",t.length===0){a.classList.remove("show");return}t.slice(0,2).forEach(r=>{const n=document.createElement("span");n.className="badge bg-primary me-2 mb-2 rezept-pill",n.draggable=!0,n.dataset.rezeptId=r.id,n.dataset.rezeptName=r.name,n.innerHTML=`<i class="bi bi-grip-vertical me-1"></i>${r.name}`,n.style.cursor="grab",a.appendChild(n)}),a.classList.add("show")}function Ge(t){const{stammdaten:a}=D(),r=t.target.value.toLowerCase();if(r.length<1){Q([]);return}const n=a.rezepte.filter(e=>e.name.toLowerCase().includes(r));Q(n)}function Ke(){const t=document.getElementById("menueplan-suche-ergebnisse");t&&(t.classList.remove("show"),t.innerHTML="")}function Ye(t){const a=document.getElementById("menueplan-suche"),r=document.getElementById("menueplan-suche-ergebnisse");a&&r&&!a.contains(t.target)&&!r.contains(t.target)&&Ke()}async function Xe(){const{showConfirmationModal:t}=await I(async()=>{const{showConfirmationModal:r}=await import("./confirmation-modal-nNV1CCn0.js");return{showConfirmationModal:r}},__vite__mapDeps([0,1,2]));if(await t("Plan leeren","Möchten Sie alle Rezepte und Zuweisungen der aktuellen Woche löschen? ACHTUNG: Diese Aktion kann nicht rückgängig gemacht werden!"))try{Ze(),z("Menüplan erfolgreich geleert!","success")}catch(r){console.error("Fehler beim Leeren des Plans:",r),z("Fehler beim Leeren des Plans.","error")}}async function Je(){const{showConfirmationModal:t}=await I(async()=>{const{showConfirmationModal:r}=await import("./confirmation-modal-nNV1CCn0.js");return{showConfirmationModal:r}},__vite__mapDeps([0,1,2]));if(await t("Einrichtungen aktualisieren",`Diese Funktion aktualisiert die Einrichtungsdaten im Menüplan mit den aktuellen Stammdaten.
        
        <div class="alert alert-info mt-3">
            <strong>Was wird aktualisiert:</strong>
            <ul class="mb-0">
                <li>Namen und Kürzel der Einrichtungen</li>
                <li>Speiseplan-Einstellungen der Einrichtungen</li>
                <li>Interne/Externe Markierungen</li>
            </ul>
        </div>
        
        <div class="alert alert-success mt-2">
            <strong>Was bleibt unverändert:</strong>
            <ul class="mb-0">
                <li>Alle Rezepte im Menüplan</li>
                <li>Alle Einrichtungs-Zuweisungen</li>
                <li>Alle anderen Plan-Daten</li>
            </ul>
        </div>
        
        Möchten Sie die Einrichtungsdaten aktualisieren?`))try{const[r,n]=C(A());console.log(`Aktualisiere Einrichtungs-Snapshot für KW ${n}/${r}`);const e=await T.updateEinrichtungsSnapshot(r,n);z("Einrichtungsdaten erfolgreich aktualisiert!","success"),console.log("📸 Snapshot aktualisiert:",e);const s=await T.getEinrichtungen(),{stammdaten:o,currentPlan:i}=D();if(i&&e.snapshot){const c={...i,einrichtungsSnapshot:e.snapshot};j(c),console.log("📸 Plan-Snapshot im Frontend-State aktualisiert")}oe({stammdaten:{...o,einrichtungen:s}}),console.log("🔄 Rendere Grid neu nach Snapshot-Update...");const{render:d}=await I(async()=>{const{render:c}=await Promise.resolve().then(()=>ct);return{render:c}},void 0);d(),console.log("✅ Grid erfolgreich neu gerendert mit neuen Einrichtungen")}catch(r){console.error("Fehler beim Aktualisieren des Snapshots:",r),r.message.includes("404")?z("Kein Menüplan für diese Woche gefunden. Erstellen Sie zuerst einen Plan.","warning"):z("Fehler beim Aktualisieren der Einrichtungen.","error")}}async function Qe(){const{showConfirmationModal:t}=await I(async()=>{const{showConfirmationModal:r}=await import("./confirmation-modal-nNV1CCn0.js");return{showConfirmationModal:r}},__vite__mapDeps([0,1,2]));if(await t("Vorlage laden","Möchten Sie den Plan von vor 7 Wochen als Vorlage laden? ACHTUNG: Alle aktuellen Änderungen gehen verloren!"))try{const r=A(),[n,e]=C(r),s=new Date(r);s.setDate(s.getDate()-7*7);const[o,i]=C(s);console.log(`Lade Vorlage von KW ${i}/${o} für KW ${e}/${n}`);const d=await T.getMenueplan(o,i);if(!d||!d.days){z("Keine Vorlage für diese Woche gefunden.","warning");return}const c={year:n,week:e,days:{...d.days},templateSource:{year:o,week:i,loadedAt:new Date().toISOString()}};delete c.updatedAt,delete c.updatedBy,delete c.einrichtungsSnapshot,j(c),z(`Vorlage von KW ${i}/${o} erfolgreich geladen!`,"success")}catch(r){console.error("Fehler beim Laden der Vorlage:",r),z("Fehler beim Laden der Vorlage.","error")}}function ee(t){const a=A();a.setDate(a.getDate()+7*t),ce(new Date(a));const[r,n]=C(A());V(r,n),B()}function et(){ce(new Date);const[t,a]=C(A());V(t,a),B()}function B(){const t=document.getElementById("menueplan-title");if(!t)return;const{currentDate:a}=D(),[r,n]=C(a),e=new Date(a);e.setDate(e.getDate()-(e.getDay()+6)%7);const s=new Date(e);s.setDate(s.getDate()+6);const o=i=>`${String(i.getDate()).padStart(2,"0")}.${String(i.getMonth()+1).padStart(2,"0")}`;t.textContent=`KW ${n} / ${r} (${o(e)} - ${o(s)})`}function tt(t){var a,r,n,e,s,o,i;V=t,(a=document.getElementById("menueplan-prev-week"))==null||a.addEventListener("click",()=>ee(-1)),(r=document.getElementById("menueplan-next-week"))==null||r.addEventListener("click",()=>ee(1)),(n=document.getElementById("menueplan-today"))==null||n.addEventListener("click",et),(e=document.getElementById("menueplan-suche"))==null||e.addEventListener("input",Ge),(s=document.getElementById("menueplan-clear"))==null||s.addEventListener("click",Xe),(o=document.getElementById("menueplan-load-7-weeks-ago"))==null||o.addEventListener("click",Qe),(i=document.getElementById("menueplan-update-einrichtungen"))==null||i.addEventListener("click",Je),document.addEventListener("click",Ye),B()}function ue(t){const a=document.createElement("div");return a.className="rezept-card",a.dataset.rezeptId=t.id,a.innerHTML=`
        <i class="bi bi-grip-vertical rezept-drag-handle" draggable="true" title="Rezept verschieben"></i>
            <span class="rezept-name">${t.name}</span>
            <button type="button" class="btn-close" aria-label="Rezept entfernen"></button>
    `,a}function nt(t,a,r,n){var o;const e=document.createElement("div");return e.className="einrichtungs-buttons d-flex flex-wrap gap-1 mt-2",(((o=r[t])==null?void 0:o[a.id])||[]).forEach(i=>{var u,m;const d=(u=n[a.id])==null?void 0:u.includes(i.id),c=a.id==="menu1"?"menu2":"menu1",h=(m=n[c])==null?void 0:m.includes(i.id),l=document.createElement("button");l.type="button",l.className=`btn flex-fill ${d?"btn-primary":"btn-outline-secondary"}`,h&&l.classList.add("d-none"),l.dataset.tag=t,l.dataset.kategorie=a.id,l.dataset.einrichtungId=i.id,l.title=i.name||"",l.textContent=i.kuerzel,e.appendChild(l)}),e}function at(t,a){t.innerHTML="",a.forEach(r=>{t.appendChild(ue(r))}),t.classList.toggle("has-content",a.length>0)}function G(){const t=document.getElementById("menueplan-grid-wrapper");if(!t)return;const{currentPlan:a,stammdaten:r}=D();if(!a||!r)return;const n=["montag","dienstag","mittwoch","donnerstag","freitag","samstag","sonntag"],e=r.stammdaten.kategorien;if(window.innerWidth<=768){rt(t,n,e,a,r);return}let o=t.querySelector(".menueplan-grid");if(!o){o=document.createElement("div"),o.className="menueplan-grid";const d=document.createElement("div");d.className="grid-header",d.innerHTML='<div class="grid-header-cell grid-corner-cell">Mahlzeit</div>',n.forEach(c=>{const h=c.charAt(0).toUpperCase()+c.slice(1);d.innerHTML+=`<div class="grid-header-cell">${h}</div>`}),o.appendChild(d),e.forEach(c=>{const h=document.createElement("div");h.className="grid-kategorie-cell",h.textContent=c.name,o.appendChild(h),n.forEach(l=>{const u=document.createElement("div");u.className="grid-cell",u.dataset.tag=l.toLowerCase(),u.dataset.kategorie=c.id;const m=document.createElement("div");m.className="cell-drag-handle",m.draggable=!0,m.innerHTML='<i class="bi bi-grip-vertical" title="Alle Rezepte in dieser Zelle verschieben"></i>',u.appendChild(m);const p=document.createElement("div");p.className="cell-content-wrapper";const f=document.createElement("div");if(f.className="drop-zone",f.id=`dropzone-${l}-${c.id}`,f.dataset.tag=l,f.dataset.kategorie=c.id,p.appendChild(f),c.id==="menu1"||c.id==="menu2"){const E=document.createElement("div");E.className="einrichtungs-buttons-wrapper",p.appendChild(E)}u.appendChild(p),o.appendChild(u)})}),t.innerHTML="",t.appendChild(o)}const i=he(r.einrichtungen,r.stammdaten);e.forEach(d=>{n.forEach(c=>{var m,p,f,E,_;const h=o.querySelector(`.grid-cell[data-tag='${c}'][data-kategorie='${d.id}']`);if(!h)return;const l=h.querySelector(".drop-zone"),u=((f=(p=(m=a.days)==null?void 0:m[c])==null?void 0:p.Mahlzeiten)==null?void 0:f[d.id])||[];if(l&&at(l,u),d.id==="menu1"||d.id==="menu2"){const b=h.querySelector(".einrichtungs-buttons-wrapper"),x=((_=(E=a.days)==null?void 0:E[c])==null?void 0:_.Zuweisungen)||{};b&&(b.innerHTML="",b.appendChild(nt(c,d,i,x)))}})})}function rt(t,a,r,n,e){let s=t.querySelector(".mobile-accordion");s||(s=document.createElement("div"),s.className="mobile-accordion",t.innerHTML="",t.appendChild(s));const o=he(e.einrichtungen,e.stammdaten);a.forEach(i=>{const d=i.charAt(0).toUpperCase()+i.slice(1);let c=s.querySelector(`[data-day="${i}"]`);if(!c){c=document.createElement("div"),c.className="day-accordion-section",c.dataset.day=i;const p=document.createElement("div");p.className="day-header",p.innerHTML=`
                <div class="day-title">
                    <span>${d}</span>
                    <span class="day-counter">0 Rezepte</span>
                </div>
                <i class="bi bi-chevron-down day-toggle-icon"></i>
            `;const f=document.createElement("div");f.className="day-content",c.appendChild(p),c.appendChild(f),s.appendChild(c),p.addEventListener("click",()=>{const E=p.classList.contains("expanded");s.querySelectorAll(".day-header").forEach(_=>{_.classList.remove("expanded"),_.parentNode.querySelector(".day-content").classList.remove("expanded")}),E||(p.classList.add("expanded"),f.classList.add("expanded"))})}const h=c.querySelector(".day-content"),l=c.querySelector(".day-header");let u=0;r.forEach(p=>{var E,_,b;const f=((b=(_=(E=n.days)==null?void 0:E[i])==null?void 0:_.Mahlzeiten)==null?void 0:b[p.id])||[];u+=f.length});const m=l.querySelector(".day-counter");m.textContent=`${u} Rezept${u!==1?"e":""}`,h.innerHTML="",r.forEach(p=>{var $,k,v,S,L;const f=document.createElement("div");f.className="mobile-category-row";const _={suppe:"🍲",menu1:"🍽️",menu2:"🥘",beilage:"🥗",dessert:"🍰",getraenk:"🥤"}[p.id]||"🍴";f.innerHTML=`
                <div class="mobile-category-title">
                    <span class="mobile-category-icon">${_}</span>
                    <span>${p.name}</span>
                </div>
                <div class="mobile-drop-zone-container">
                    <div class="mobile-zone-drag-handle" data-tag="${i}" data-kategorie="${p.id}" title="Alle Rezepte dieser Kategorie verschieben">
                        <i class="bi bi-grip-vertical"></i>
                    </div>
                    <div class="mobile-drop-zone" data-tag="${i}" data-kategorie="${p.id}" id="mobile-dropzone-${i}-${p.id}">
                        <div class="mobile-drop-zone-placeholder">Rezept hier hinzufügen</div>
                    </div>
                </div>
            `,h.appendChild(f);const b=f.querySelector(".mobile-drop-zone"),x=((v=(k=($=n.days)==null?void 0:$[i])==null?void 0:k.Mahlzeiten)==null?void 0:v[p.id])||[];if(it(b,x),p.id==="menu1"||p.id==="menu2"){const H=((L=(S=n.days)==null?void 0:S[i])==null?void 0:L.Zuweisungen)||{},fe=st(i,p,o,H);f.appendChild(fe)}})})}function it(t,a){const r=t.querySelector(".mobile-drop-zone-placeholder"),n=t.closest(".mobile-drop-zone-container");a.length===0?(r&&(r.style.display="block"),t.classList.remove("has-content"),n&&n.classList.remove("has-content"),t.querySelectorAll(".rezept-card").forEach(e=>e.remove())):(r&&(r.style.display="none"),t.classList.add("has-content"),n&&n.classList.add("has-content"),t.querySelectorAll(".rezept-card").forEach(e=>e.remove()),a.forEach(e=>{t.appendChild(ue(e))}))}function st(t,a,r,n){var o;const e=document.createElement("div");e.className="mobile-einrichtungs-buttons";const s=((o=r[t])==null?void 0:o[a.id])||[];if(s.length>0){const i=document.createElement("div");i.className="fw-bold text-muted mb-2",i.innerHTML='<i class="bi bi-building"></i> Einrichtungs-Zuweisungen:',e.appendChild(i),s.forEach(d=>{var u,m;const c=(u=n[a.id])==null?void 0:u.includes(d.id),h=a.id==="menu1"?"menu2":"menu1";if(!((m=n[h])==null?void 0:m.includes(d.id))){const p=document.createElement("button");p.type="button",p.className=`btn ${c?"btn-primary":"btn-outline-secondary"}`,p.dataset.tag=t,p.dataset.kategorie=a.id,p.dataset.einrichtungId=d.id,p.title=d.name||"",p.textContent=d.kuerzel,e.appendChild(p)}})}return e}function he(t,a){var o;const{currentPlan:r}=D();let n=t;(o=r==null?void 0:r.einrichtungsSnapshot)!=null&&o.einrichtungen&&(console.log("Verwende historischen Einrichtungs-Snapshot für Menüplan"),n=r.einrichtungsSnapshot.einrichtungen);const e={};return["montag","dienstag","mittwoch","donnerstag","freitag","samstag","sonntag"].forEach(i=>{var c,h;e[i]={},a.kategorien.forEach(l=>{e[i][l.id]=[]}),n.forEach(l=>{if(l.isIntern===!0){a.kategorien.forEach(m=>{e[i][m.id]&&e[i][m.id].push({id:l.id,kuerzel:l.kuerzel,name:l.name,isIntern:!0})});return}if(!l.speiseplan||!l.speiseplan[i])return;const u=l.speiseplan[i];u.suppe&&e[i].suppe.push({id:l.id,kuerzel:l.kuerzel,name:l.name}),u.dessert&&e[i].dessert.push({id:l.id,kuerzel:l.kuerzel,name:l.name}),u.hauptspeise&&(e[i].menu1&&e[i].menu1.push({id:l.id,kuerzel:l.kuerzel,name:l.name}),e[i].menu2&&e[i].menu2.push({id:l.id,kuerzel:l.kuerzel,name:l.name}))});const d=((h=(c=r==null?void 0:r.days)==null?void 0:c[i])==null?void 0:h.Zuweisungen)||{};["menu1","menu2"].forEach(l=>{(d[l]||[]).forEach(m=>{if(!e[i][l].some(f=>f.id===m)){const f=n.find(E=>E.id===m);f&&(console.log(`📌 Behalte zugewiesene Einrichtung ${f.name} für ${i}/${l}, auch wenn nicht mehr im Speiseplan`),e[i][l].push({id:f.id,kuerzel:f.kuerzel,name:f.name,hasAssignment:!0}))}})})}),e}function ot(t){const a=t.target.closest(".btn-close");if(a){const n=a.closest(".rezept-card"),e=n.closest(".drop-zone");qe(e.dataset.tag,e.dataset.kategorie,n.dataset.rezeptId);return}const r=t.target.closest("button[data-einrichtung-id]");if(r){const{tag:n,kategorie:e,einrichtungId:s}=r.dataset;Fe(n,e,s)}}function pe(){const t=document.getElementById("menueplan-grid-wrapper");if(t){t.addEventListener("click",ot);let a;window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(()=>{console.log("Fenster-Größe geändert, re-rendere Layout..."),G(),I(()=>Promise.resolve().then(()=>ut),void 0).then(r=>{r.initDragAndDrop()})},250)})}}const ct=Object.freeze(Object.defineProperty({__proto__:null,initGrid:pe,render:G},Symbol.toStringTag,{value:"Module"}));let y=null,w=null,O=null;function te(t){const a=t.target.closest(".rezept-card");if(!a)return;const r=a.closest(".grid-cell");if(!r)return;const n=a.dataset.rezeptId,e=a.querySelector(".rezept-name").textContent;t.dataTransfer.setData("text/plain",n),t.dataTransfer.setData("rezept-name",e),t.dataTransfer.setData("source-tag",r.dataset.tag),t.dataTransfer.setData("source-kategorie",r.dataset.kategorie),t.dataTransfer.effectAllowed="move",P({type:"rezept",id:n})}function lt(t,a){t.dataTransfer.setData("text/plain",a.id),t.dataTransfer.setData("rezept-name",a.name),t.dataTransfer.effectAllowed="move",P({type:"rezept",id:a.id})}function dt(t){var d,c,h;const a=t.target.closest(".cell-drag-handle");if(!a)return;const r=a.closest(".grid-cell");if(!r)return;const{tag:n,kategorie:e}=r.dataset,{currentPlan:s}=D(),o=((h=(c=(d=s.days)==null?void 0:d[n])==null?void 0:c.Mahlzeiten)==null?void 0:h[e])||[];if(o.length===0){t.preventDefault();return}const i={recipes:o,sourceTag:n,sourceKategorie:e};t.dataTransfer.setData("application/json/cell-drop",JSON.stringify(i)),t.dataTransfer.effectAllowed="move",P({type:"cell",sourceKategorie:e,sourceTag:n})}function ne(t){var c,h,l;t.preventDefault(),t.stopPropagation();const a=t.currentTarget.closest(".grid-cell"),r=t.currentTarget.closest(".mobile-drop-zone"),n=a||r;if(!n)return;n.classList.remove("drag-over-active","drag-over-invalid");const{currentDragData:e,currentPlan:s}=D();if(!e)return;const{tag:o,kategorie:i}=n.dataset,d=t.dataTransfer.getData("application/json/cell-drop");if(d){const{sourceTag:u,sourceKategorie:m}=JSON.parse(d);if(o===u&&i===m)return;de(o,i,u,m),P(null);return}if(e.type==="rezept"){const u=t.dataTransfer.getData("text/plain");if(!u)return;const m=t.dataTransfer.getData("rezept-name"),p=t.dataTransfer.getData("source-tag"),f=t.dataTransfer.getData("source-kategorie");if((((l=(h=(c=s.days)==null?void 0:c[o])==null?void 0:h.Mahlzeiten)==null?void 0:l[i])||[]).some(_=>_.id===u)){n.classList.add("drag-over-invalid"),setTimeout(()=>n.classList.remove("drag-over-invalid"),500);return}le(o,i,u,m,p,f)}P(null)}function ae(t){var d,c,h;t.preventDefault();const a=t.currentTarget.closest(".grid-cell"),r=t.currentTarget.closest(".mobile-drop-zone"),n=a||r;if(!n)return;const{currentDragData:e,currentPlan:s}=D();if(!e)return;const{tag:o,kategorie:i}=n.dataset;if(e.type==="cell"&&a&&o===e.sourceTag&&i===e.sourceKategorie){n.classList.add("drag-over-invalid");return}if(e.type==="rezept"){const l=e.id;if((((h=(c=(d=s.days)==null?void 0:d[o])==null?void 0:c.Mahlzeiten)==null?void 0:h[i])||[]).some(m=>m.id===l)){n.classList.add("drag-over-invalid");return}}n.classList.remove("drag-over-invalid"),n.classList.add("drag-over-active")}function re(t){t.preventDefault();const a=t.currentTarget.closest(".grid-cell"),r=t.currentTarget.closest(".mobile-drop-zone"),n=a||r;n&&n.classList.remove("drag-over-active","drag-over-invalid")}function q(t){var e,s,o;const a=t.target.closest(".mobile-zone-drag-handle");if(a){const{tag:i,kategorie:d}=a.dataset,{currentPlan:c}=D(),h=((o=(s=(e=c.days)==null?void 0:e[i])==null?void 0:s.Mahlzeiten)==null?void 0:o[d])||[];if(h.length===0)return;w=a,y={type:"zone",recipes:h,sourceTag:i,sourceKategorie:d},a.classList.add("zone-dragging");const l=a.closest(".mobile-category-row");l&&(l.style.opacity="0.7",l.style.transform="scale(0.98)");return}const r=t.target.closest(".rezept-card"),n=t.target.closest(".rezept-pill");if(r){const i=r.closest(".grid-cell, .mobile-drop-zone");if(!i)return;w=r,y={type:"rezept",id:r.dataset.rezeptId,name:r.querySelector(".rezept-name").textContent,sourceTag:i.dataset.tag,sourceKategorie:i.dataset.kategorie},r.style.opacity="0.7",r.style.transform="scale(0.95)"}else n&&(w=n,y={type:"rezept",id:n.dataset.rezeptId,name:n.dataset.rezeptName,sourceTag:null,sourceKategorie:null},n.style.opacity="0.7",n.style.transform="scale(0.95)");y&&(P(y),document.querySelectorAll(".grid-cell, .mobile-drop-zone").forEach(i=>{i.classList.add("touch-drop-zone-highlight")}))}function Z(t){var e,s,o;if(!y)return;t.preventDefault();const a=t.touches[0],r=document.elementFromPoint(a.clientX,a.clientY),n=r==null?void 0:r.closest(".grid-cell, .mobile-drop-zone");if(document.querySelectorAll(".touch-drop-zone-active, .touch-drop-zone-invalid").forEach(i=>{i.classList.remove("touch-drop-zone-active","touch-drop-zone-invalid")}),n&&n.dataset.tag&&n.dataset.kategorie){const{currentPlan:i}=D(),{tag:d,kategorie:c}=n.dataset;y.type==="zone"?d===y.sourceTag&&c===y.sourceKategorie?n.classList.add("touch-drop-zone-invalid"):(n.classList.add("touch-drop-zone-active"),O=n):y.type==="rezept"&&((((o=(s=(e=i.days)==null?void 0:e[d])==null?void 0:s.Mahlzeiten)==null?void 0:o[c])||[]).some(u=>u.id===y.id)?n.classList.add("touch-drop-zone-invalid"):(n.classList.add("touch-drop-zone-active"),O=n))}else O=null}function F(t){if(y){if(w)if(y.type==="zone"){w.classList.remove("zone-dragging");const a=w.closest(".mobile-category-row");a&&(a.style.opacity="",a.style.transform="")}else w.style.opacity="",w.style.transform="";if(document.querySelectorAll(".touch-drop-zone-highlight, .touch-drop-zone-active, .touch-drop-zone-invalid").forEach(a=>{a.classList.remove("touch-drop-zone-highlight","touch-drop-zone-active","touch-drop-zone-invalid")}),O){const{tag:a,kategorie:r}=O.dataset;if(y.type==="zone"){const{sourceTag:n,sourceKategorie:e,recipes:s}=y;de(a,r,n,e),I(async()=>{const{showToast:o}=await import("./toast-notification-BBb3bACE.js");return{showToast:o}},__vite__mapDeps([3,1,2,4])).then(({showToast:o})=>{const i=s.length;o(`${i} Rezept${i>1?"e":""} verschoben`,"success")})}else if(y.type==="rezept"){const{id:n,name:e,sourceTag:s,sourceKategorie:o}=y;le(a,r,n,e,s,o),I(async()=>{const{showToast:i}=await import("./toast-notification-BBb3bACE.js");return{showToast:i}},__vite__mapDeps([3,1,2,4])).then(({showToast:i})=>{i(`Rezept "${e}" hinzugefügt`,"success")})}}y=null,w=null,O=null,P(null)}}function me(){const t=document.querySelector(".menueplan-grid");t&&(t.addEventListener("dragstart",e=>{e.target.closest(".rezept-drag-handle")?te(e):e.target.closest(".cell-drag-handle")&&dt(e)}),t.querySelectorAll(".grid-cell").forEach(e=>{e.addEventListener("dragover",ae),e.addEventListener("dragleave",re),e.addEventListener("drop",ne)}));const a=document.querySelector(".mobile-accordion");a&&(a.addEventListener("dragstart",e=>{e.target.closest(".rezept-drag-handle")&&te(e)}),a.querySelectorAll(".mobile-drop-zone").forEach(e=>{e.addEventListener("dragover",ae),e.addEventListener("dragleave",re),e.addEventListener("drop",ne)}),a.addEventListener("touchstart",q,{passive:!1}),a.addEventListener("touchmove",Z,{passive:!1}),a.addEventListener("touchend",F,{passive:!1})),t&&(t.addEventListener("touchstart",q,{passive:!1}),t.addEventListener("touchmove",Z,{passive:!1}),t.addEventListener("touchend",F,{passive:!1}));const r=document.getElementById("menueplan-suche-ergebnisse");r&&(r.addEventListener("dragstart",n=>{const e=n.target.closest(".rezept-pill");if(e){const s={id:e.dataset.rezeptId,name:e.dataset.rezeptName};lt(n,s)}}),r.addEventListener("touchstart",q,{passive:!1}),r.addEventListener("touchmove",Z,{passive:!1}),r.addEventListener("touchend",F,{passive:!1}))}const ut=Object.freeze(Object.defineProperty({__proto__:null,initDragAndDrop:me},Symbol.toStringTag,{value:"Module"})),ie=document.getElementById("app");function ht(){const t=document.getElementById("autosave-indicator"),a=t.querySelector(".indicator-icon"),r=t.querySelector(".indicator-text");let n;const e=(s,o)=>{if(clearTimeout(n),t.className=`text-muted visible ${s}`,a.className="indicator-icon bi bi-arrow-repeat",r.textContent=o,s==="success"||s==="error"){const i=s==="success"?"bi-check-circle-fill":"bi-x-circle-fill";a.className=`indicator-icon bi ${i}`,n=setTimeout(()=>{t.classList.remove("visible")},2e3)}};Re({onSaving:()=>e("saving","Speichert..."),onSuccess:()=>e("success","Gespeichert"),onError:()=>e("error","Speicherfehler")})}async function se(t,a){try{const r=await T.getMenueplan(t,a);j(r)}catch(r){console.error(`Fehler beim Laden des Plans für KW ${a}/${t}:`,r),j(null)}}async function pt(t){if(ie)try{const[a,r,n]=await Promise.all([T.getStammdaten(),T.getEinrichtungen(),T.getRezepte()]);oe({stammdaten:{stammdaten:a,einrichtungen:r,rezepte:n}}),Ne(()=>{G(),B(),ht()}),tt(se),pe();const[s,o]=C(A());await se(s,o),me()}catch(a){console.error("Schwerwiegender Fehler bei der Initialisierung des Menüplans:",a),ie.innerHTML='<div class="alert alert-danger">Das Menüplan-Modul konnte nicht geladen werden.</div>'}}document.addEventListener("DOMContentLoaded",async()=>{try{const t=await ge();console.log("Header geladen, Menüplan-UI wird initialisiert..."),await pt(t),z("Menüplan erfolgreich geladen!","success")}catch(t){console.error("Fehler bei der Initialisierung des Menüplan-Moduls:",t),z("Fehler beim Laden des Menüplan-Moduls.","error");const a=document.getElementById("app");a&&(a.innerHTML=`
                <div class="alert alert-danger mt-4" role="alert">
                    <h4 class="alert-heading">Fehler beim Laden</h4>
                    <p>Das Menüplan-Modul konnte nicht geladen werden.</p>
                    <hr>
                    <p class="mb-0">Bitte laden Sie die Seite neu oder kontaktieren Sie den Administrator.</p>
                </div>
            `)}});
